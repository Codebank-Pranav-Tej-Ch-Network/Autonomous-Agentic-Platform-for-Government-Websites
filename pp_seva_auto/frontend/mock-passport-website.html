<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passport Seva - Ministry of External Affairs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #f5f5f5;
        }

        /* Top Bar */
        .top-bar {
            background: #fffbec;
            padding: 8px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }

        /* Header */
        .header {
            background: white;
            padding: 15px 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .emblem {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #ff9933 0%, #ffffff 50%, #138808 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .header-text h1 {
            font-size: 26px;
            color: #003d82;
            margin-bottom: 3px;
        }

        .header-text p {
            font-size: 12px;
            color: #666;
        }

        .user-section {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info strong {
            color: #003d82;
        }

        .btn-logout {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Navigation */
        .nav {
            background: #1e3a5f;
        }

        .nav ul {
            list-style: none;
            display: flex;
            margin: 0;
        }

        .nav li { flex: 1; }

        .nav a {
            color: white;
            text-decoration: none;
            padding: 15px 20px;
            display: block;
            text-align: center;
            transition: background 0.3s;
        }

        .nav a:hover { background: #2c5282; }
        .nav a.active { background: #0066cc; }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 30px auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        /* Login */
        .login-container {
            max-width: 450px;
            margin: 50px auto;
            padding: 40px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-radius: 8px;
        }

        .login-container h2 {
            color: #003d82;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-size: 14px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .btn-primary {
            width: 100%;
            background: #0066cc;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-primary:hover { background: #0052a3; }

        /* Service Cards */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .service-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .service-card:hover {
            border-color: #0066cc;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .service-card-icon { font-size: 48px; margin-bottom: 15px; }
        .service-card h3 { color: #003d82; font-size: 18px; margin-bottom: 10px; }
        .service-card p { color: #666; font-size: 14px; line-height: 1.6; }

        /* Page Content */
        .page-content { display: none; }
        .page-content.active { display: block; }

        .page-title {
            color: #003d82;
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #0066cc;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
            overflow-x: auto;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e0e0e0;
            z-index: 0;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
            min-width: 100px;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            background: #e0e0e0;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #999;
            transition: all 0.3s;
        }

        .step.active .step-circle {
            background: #0066cc;
            color: white;
        }

        .step.completed .step-circle {
            background: #4caf50;
            color: white;
        }

        .step-label {
            font-size: 11px;
            color: #666;
        }

        /* Form Sections */
        .form-stage {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .form-stage.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .form-section h3 {
            color: #003d82;
            font-size: 16px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #0066cc;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-row.single { grid-template-columns: 1fr; }

        .required { color: #d32f2f; }

        .auto-filling {
            border-color: #4caf50 !important;
            background: #e8f5e9 !important;
            animation: fillPulse 0.6s ease-out;
        }

        @keyframes fillPulse {
            0% { transform: scale(1); background: #fff59d; }
            50% { transform: scale(1.02); background: #e8f5e9; }
            100% { transform: scale(1); background: #e8f5e9; }
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover { background: #5a6268; }

        /* Info Boxes */
        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #1565c0;
        }

        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #e65100;
        }

        /* Success Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 8px;
            max-width: 500px;
            text-align: center;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success-icon {
            font-size: 64px;
            color: #4caf50;
            margin-bottom: 20px;
        }

        .reference-number {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
            color: #0066cc;
        }

        /* Radio Buttons */
        .radio-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-group input[type="radio"] {
            width: auto;
        }

        /* CAPTCHA */
        .captcha-container {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 6px;
            padding: 25px;
            text-align: center;
            margin: 30px 0;
        }

        .captcha-image {
            background: white;
            border: 2px solid #ccc;
            padding: 15px 30px;
            display: inline-block;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 28px;
            letter-spacing: 10px;
            font-weight: bold;
            /* This is the fix for older Safari */
-webkit-user-select: none;  

/* This is your original line for modern browsers */
user-select: none;
            position: relative;
        }

        .captcha-image::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #666;
            transform: rotate(-3deg);
        }

        /* Home Page */
        .welcome-banner {
            background: #e8f4f8;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 4px;
        }

        .welcome-banner h2 {
            color: #003d82;
            margin-bottom: 10px;
        }

        .saved-applications {
            margin-top: 30px;
        }

        .app-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .app-card h4 {
            color: #003d82;
            margin-bottom: 10px;
        }

        .app-card-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }

        /* Applications Table */
        .applications-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .applications-table th,
        .applications-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .applications-table th {
            background: #f8f9fa;
            color: #003d82;
            font-weight: bold;
        }

        .applications-table tr:hover {
            background: #f8f9fa;
        }

        /* Fee Calculator */
        .fee-calculator {
            max-width: 600px;
        }

        .fee-result {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .fee-result.show {
            display: block;
        }

        .fee-amount {
            font-size: 32px;
            color: #2e7d32;
            font-weight: bold;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .service-grid { grid-template-columns: 1fr; }
            .nav ul { flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" style="display: block;">
        <div class="top-bar">
            <div>Friday, November 07, 2025 | 12:57 PM</div>
            <div>ðŸ“ž National Call Centre: 1800-258-1800</div>
        </div>

        <div class="header">
            <div class="emblem">ðŸ‡®ðŸ‡³</div>
            <div class="header-text">
                <h1>Passport Seva</h1>
                <p>Ministry of External Affairs, Government of India</p>
            </div>
        </div>

        <div class="login-container">
            <h2>Login to Passport Seva</h2>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email Address / User ID</label>
                    <input type="text" id="loginEmail" required placeholder="Enter your email">
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                </div>

                <button type="submit" class="btn-primary">Login</button>
            </form>
        </div>

        <div style="background: #1e3a5f; color: white; text-align: center; padding: 20px; margin-top: 50px; font-size: 13px;">
            Â©Content owned by Ministry of External Affairs, Government of India | Last Updated On 10.11.2025
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" style="display: none;">
        <div class="top-bar">
            <div>Friday, November 07, 2025 | 12:57 PM</div>
            <div>ðŸ“ž National Call Centre: 1800-258-1800</div>
        </div>

        <div class="header">
            <div class="emblem">ðŸ‡®ðŸ‡³</div>
            <div class="header-text">
                <h1>Passport Seva</h1>
                <p>Ministry of External Affairs, Government of India</p>
            </div>
            <div class="user-section">
                <div class="user-info">
                    <strong id="userName">User Account</strong>
                </div>
                <button class="btn-logout" onclick="logout()">Logout</button>
            </div>
        </div>

        <nav class="nav">
            <ul>
                <li><a href="#" class="active" onclick="showPage(event, 'home')">Home</a></li>
                <li><a href="#" onclick="showPage(event, 'services')">Services</a></li>
                <li><a href="#" onclick="showPage(event, 'applications')">My Applications</a></li>
                <li><a href="#" onclick="showPage(event, 'fees')">Fee Details</a></li>
            </ul>
        </nav>

        <div class="container">
            <!-- Home Page -->
            <div id="homePage" class="page-content active">
                <div class="welcome-banner">
                    <h2>Welcome back <span id="welcomeName"></span>!</h2>
                    <p>Want to apply for a new passport? Start applying for all your passport related services here!</p>
                    <button class="btn-primary" onclick="showPage(null, 'services')" style="margin-top: 15px; width: auto; padding: 10px 30px;">Services</button>
                </div>

                <h3 style="color: #003d82; margin-bottom: 20px;">Saved/Draft Applications</h3>
                <div id="savedApplications">
                    <p style="color: #666;">No saved applications</p>
                </div>
            </div>

            <!-- Services Page -->
            <div id="servicesPage" class="page-content">
                <h2 class="page-title">Application Services</h2>
                
                <div class="service-grid">
                    <div class="service-card" onclick="startApplication('fresh')">
                        <div class="service-card-icon">ðŸ“˜</div>
                        <h3>Apply for Fresh Passport/Re-issue of Passport</h3>
                        <p>An Ordinary passport (Deep Blue colour passport) consists of 36/60 pages. Choose fresh category if applying first time for Ordinary passport.</p>
                    </div>

                    <div class="service-card" onclick="startApplication('pcc')">
                        <div class="service-card-icon">ðŸ‘®</div>
                        <h3>Apply for Police Clearance Certificate (PCC)</h3>
                        <p>Police Clearance Certificate (PCC) is issued to Indian Passport holders in case they have applied for Citizenship/Nationality, Employment, Education/Research, Resident Permit or Tourist Visa.</p>
                    </div>

                    <div class="service-card" onclick="startApplication('identity')">
                        <div class="service-card-icon">ðŸ†”</div>
                        <h3>Apply for Identity Certificate</h3>
                        <p>Certificate of Identity (Yellow cover booklet) is issued to Stateless persons, including Tibetan refugees residing in India.</p>
                    </div>

                    <div class="service-card">
                        <div class="service-card-icon">ðŸ“œ</div>
                        <h3>Apply for Surrender Certificate</h3>
                        <p>Surrender Certificate is issued to a person surrendering their passport at the Offices for renunciation of Indian citizenship and acquiring foreign nationality.</p>
                    </div>
                </div>
            </div>

            <!-- My Applications Page -->
            <div id="applicationsPage" class="page-content">
                <h2 class="page-title">My Applications</h2>
                
                <div style="margin-bottom: 20px;">
                    <input type="text" placeholder="Search by ARN, File No., Name" style="width: 400px; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                </div>

                <div style="border-bottom: 2px solid #0066cc; margin-bottom: 20px;">
                    <button style="padding: 10px 20px; background: #0066cc; color: white; border: none; border-radius: 4px 4px 0 0; margin-right: 10px;">Submitted Applications</button>
                    <button style="padding: 10px 20px; background: transparent; color: #003d82; border: none;">Saved/Draft Applications</button>
                </div>

                <table class="applications-table">
                    <thead>
                        <tr>
                            <th>Application Type</th>
                            <th>ARN/File No.</th>
                            <th>Applicant Name</th>
                            <th>Submission Date</th>
                            <th>Payment Status</th>
                            <th>Appointment Date</th>
                        </tr>
                    </thead>
                    <tbody id="submittedApplicationsTable">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px; color: #666;">No applications submitted yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Fee Details Page -->
            <div id="feesPage" class="page-content">
                <h2 class="page-title">Fee Calculator</h2>

                <div class="fee-calculator">
                    <p style="color: #666; margin-bottom: 20px;">Fields marked with asterisk ( <span style="color: #d32f2f;">*</span> ) are mandatory</p>

                    <div class="form-group">
                        <label>Select Application Type<span class="required">*</span></label>
                        <select id="feeAppType">
                            <option value="">Select</option>
                            <option value="passport">Passport</option>
                            <option value="pcc">Police Clearance Certificate</option>
                            <option value="identity">Identity Certificate</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Type Of Service<span class="required">*</span></label>
                        <select id="feeServiceType">
                            <option value="">Select</option>
                            <option value="normal">Normal</option>
                            <option value="tatkaal">Tatkaal</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Applicant's Age<span class="required">*</span></label>
                        <select id="feeAge">
                            <option value="">Select</option>
                            <option value="minor">Below 18 years</option>
                            <option value="adult">18-60 years</option>
                            <option value="senior">Above 60 years</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Required Scheme<span class="required">*</span></label>
                        <select id="feeScheme">
                            <option value="">Select</option>
                            <option value="36">36 Pages</option>
                            <option value="60">60 Pages</option>
                        </select>
                    </div>

                    <button class="btn-primary" onclick="calculateFee()">Calculate Fee</button>

                    <div class="fee-result" id="feeResult">
                        <h3 style="color: #2e7d32; margin-bottom: 10px;">Passport Fee</h3>
                        <div class="fee-amount" id="feeAmount">â‚¹ 1,500</div>
                        <p style="font-size: 13px; color: #666; margin-top: 15px;">
                            Note: For fresh Passport application, a rebate of 10% on basic Passport fee will be applicable for minor applicants (age <= 8 years) and senior citizens (age > 60 years)
                        </p>
                    </div>
                </div>
            </div>

            <!-- Application Form Page -->
            <div id="applicationPage" class="page-content">
                <h2 class="page-title" id="appTitle">New Application</h2>

                <!-- Progress Steps -->
                <div class="progress-steps" id="progressSteps"></div>

                <form id="applicationForm">
                    <!-- Stage 1: Passport Type -->
                    <div id="stage1" class="form-stage">
                        <div class="warning-box">
                            <strong>Important Note:</strong> Please read the Passport Instruction Booklet carefully before filling the application form. Furnishing of incorrect information/suppression of information would lead to rejection of application and would attract penal provisions as prescribed under the Passports Act, 1967.
                        </div>

                        <div class="form-section">
                            <h3>Passport Type</h3>
                            
                            <div class="form-group">
                                <label>Applying for <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="applyingFor" value="fresh" required checked> Fresh Passport</label>
                                    <label><input type="radio" name="applyingFor" value="reissue"> Re-issue of Passport</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Type of Application <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="applicationType" value="normal" required checked> Normal</label>
                                    <label><input type="radio" name="applicationType" value="tatkaal"> Tatkaal</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Type of Passport Booklet <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="bookletType" value="36" required checked> 36 Pages</label>
                                    <label><input type="radio" name="bookletType" value="60"> 60 Pages</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 2: Applicant Details -->
                    <div id="stage2" class="form-stage">
                        <div class="form-section">
                            <h3>Personal Details</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Given Name (First + Middle) <span class="required">*</span></label>
                                    <input type="text" id="givenName" name="givenName" required>
                                </div>
                                <div class="form-group">
                                    <label>Surname</label>
                                    <input type="text" id="surname" name="surname">
                                </div>
                            </div>

                            <div class="info-box" style="font-size: 12px;">
                                Note: Initials and honorifics (e.g. Dr., Col.) are not allowed.
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Gender <span class="required">*</span></label>
                                    <select id="gender" name="gender" required>
                                        <option value="">Select</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Transgender">Transgender</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Date of Birth (DD/MM/YYYY) <span class="required">*</span></label>
                                    <input type="date" id="dob" name="dob" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Place of Birth (Village/Town/City) <span class="required">*</span></label>
                                    <input type="text" id="placeOfBirth" name="placeOfBirth" required>
                                </div>
                                <div class="form-group">
                                    <label>Marital Status <span class="required">*</span></label>
                                    <select id="maritalStatus" name="maritalStatus" required>
                                        <option value="">Select</option>
                                        <option value="Single">Single</option>
                                        <option value="Married">Married</option>
                                        <option value="Divorced">Divorced</option>
                                        <option value="Separated">Separated</option>
                                        <option value="Widow/Widower">Widow/Widower</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Is your Place of Birth out of India? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="birthOutIndia" value="no" required checked> No</label>
                                    <label><input type="radio" name="birthOutIndia" value="yes"> Yes</label>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Citizenship of India by <span class="required">*</span></label>
                                    <select id="citizenship" name="citizenship" required>
                                        <option value="">Select</option>
                                        <option value="Birth">Birth</option>
                                        <option value="Descent">Descent</option>
                                        <option value="Registration/Naturalization">Registration/Naturalization</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>PAN (if available)</label>
                                    <input type="text" id="pan" name="pan" maxlength="10">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Voter ID (if available)</label>
                                    <input type="text" id="voterId" name="voterId">
                                </div>
                                <div class="form-group">
                                    <label>Aadhaar Number (if available)</label>
                                    <input type="text" id="aadhaar" name="aadhaar" maxlength="12">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Employment & Education</h3>

                            <div class="form-group">
                                <label>Employment Type <span class="required">*</span></label>
                                <select id="employment" name="employment" required>
                                    <option value="">Select</option>
                                    <option value="Government">Government</option>
                                    <option value="Private">Private</option>
                                    <option value="PSU">PSU</option>
                                    <option value="Self Employed">Self Employed</option>
                                    <option value="Student">Student</option>
                                    <option value="Homemaker">Homemaker</option>
                                    <option value="Not Employed">Not Employed</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Educational Qualification <span class="required">*</span></label>
                                <select id="education" name="education" required>
                                    <option value="">Select</option>
                                    <option value="7th Pass Or Less">7th Pass Or Less</option>
                                    <option value="Between 8th And 9th">Between 8th And 9th</option>
                                    <option value="10th Pass And Above">10th Pass And Above</option>
                                    <option value="Graduate And Above">Graduate And Above</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Is applicant eligible for Non-ECR category? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="nonECR" value="yes" required> Yes</label>
                                    <label><input type="radio" name="nonECR" value="no" checked> No</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Visible distinguishing mark</label>
                                <input type="text" id="distinguishingMark" name="distinguishingMark">
                            </div>
                        </div>
                    </div>

                    <!-- Stage 3: Family Details -->
                    <div id="stage3" class="form-stage">
                        <div class="info-box">
                            <strong>Important Note:</strong> Please enter details of both parents. Only in exceptional cases having supporting documents (Court order etc.) applicant is exempted from providing name of one of the parents.
                        </div>

                        <div class="form-section">
                            <h3>Father's/Legal Guardian's Details</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Father's Given Name <span class="required">*</span></label>
                                    <input type="text" id="fatherGivenName" name="fatherGivenName" required>
                                </div>
                                <div class="form-group">
                                    <label>Father's Surname</label>
                                    <input type="text" id="fatherSurname" name="fatherSurname">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Mother's Details</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Mother's Given Name <span class="required">*</span></label>
                                    <input type="text" id="motherGivenName" name="motherGivenName" required>
                                </div>
                                <div class="form-group">
                                    <label>Mother's Surname</label>
                                    <input type="text" id="motherSurname" name="motherSurname">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Legal Guardian (If applicable)</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Guardian's Given Name</label>
                                    <input type="text" id="guardianGivenName" name="guardianGivenName">
                                </div>
                                <div class="form-group">
                                    <label>Guardian's Surname</label>
                                    <input type="text" id="guardianSurname" name="guardianSurname">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 4: Address Details -->
                    <div id="stage4" class="form-stage">
                        <div class="form-section">
                            <h3>Present Residential Address</h3>

                            <div class="form-group">
                                <label>Is your present address out of India? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="addressOutIndia" value="no" required checked> No</label>
                                    <label><input type="radio" name="addressOutIndia" value="yes"> Yes</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>House No. and Street Name <span class="required">*</span></label>
                                <input type="text" id="houseNo" name="houseNo" required maxlength="48">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Village/Town/City <span class="required">*</span></label>
                                    <input type="text" id="city" name="city" required>
                                </div>
                                <div class="form-group">
                                    <label>PIN Code <span class="required">*</span></label>
                                    <input type="text" id="pincode" name="pincode" required pattern="[0-9]{6}">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>State/UT <span class="required">*</span></label>
                                    <select id="state" name="state" required onchange="updateDistricts()">
                                        <option value="">Select</option>
                                        <option value="AP">Andhra Pradesh</option>
                                        <option value="TN">Tamil Nadu</option>
                                        <option value="KA">Karnataka</option>
                                        <option value="MH">Maharashtra</option>
                                        <option value="DL">Delhi</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>District <span class="required">*</span></label>
                                    <select id="district" name="district" required>
                                        <option value="">Select State First</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Police Station <span class="required">*</span></label>
                                    <select id="policeStation" name="policeStation" required>
                                        <option value="">Select District First</option>
                                        <option value="Station1">Police Station 1</option>
                                        <option value="Station2">Police Station 2</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Mobile Number (Without Country Code) <span class="required">*</span></label>
                                    <input type="tel" id="mobile" name="mobile" required pattern="[0-9]{10}">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Telephone Number</label>
                                    <input type="tel" id="telephone" name="telephone">
                                </div>
                                <div class="form-group">
                                    <label>E-mail ID <span class="required">*</span></label>
                                    <input type="email" id="email" name="email" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Is Permanent Address available? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="permanentAddress" value="yes" required> Yes</label>
                                    <label><input type="radio" name="permanentAddress" value="no" checked> No</label>
                                </div>
                            </div>

                            <div class="warning-box">
                                <strong>Please note:</strong> You will not be able to change the RPO after saving the application form details and will have to visit an Application Submission Centre which lies under the RPO chosen by you for this as well as other future applications filled using this account (User ID: <span id="displayUserEmail"></span>).
                            </div>
                        </div>
                    </div>

                    <!-- Stage 5: Emergency Contact -->
                    <div id="stage5" class="form-stage">
                        <div class="form-section">
                            <h3>Emergency Contact Details</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Emergency Contact Name <span class="required">*</span></label>
                                    <input type="text" id="emergencyName" name="emergencyName" required>
                                </div>
                                <div class="form-group">
                                    <label>Mobile Number <span class="required">*</span></label>
                                    <input type="tel" id="emergencyMobile" name="emergencyMobile" required pattern="[0-9]{10}">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Emergency Contact Address <span class="required">*</span></label>
                                <textarea id="emergencyAddress" name="emergencyAddress" rows="3" required></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 6: Previous Passport -->
                    <div id="stage6" class="form-stage">
                        <div class="form-section">
                            <h3>Previous Passport/IC Details</h3>

                            <div class="form-group">
                                <label>Have you held a passport/IC before? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="heldPassport" value="no" required checked onchange="togglePreviousPassport()"> No</label>
                                    <label><input type="radio" name="heldPassport" value="yes" onchange="togglePreviousPassport()"> Yes</label>
                                </div>
                            </div>

                            <div id="previousPassportFields" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Previous Passport Number</label>
                                        <input type="text" id="prevPassNum" name="prevPassNum">
                                    </div>
                                    <div class="form-group">
                                        <label>Date of Issue</label>
                                        <input type="date" id="prevPassDate" name="prevPassDate">
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Place of Issue</label>
                                        <input type="text" id="prevPassPlace" name="prevPassPlace">
                                    </div>
                                    <div class="form-group">
                                        <label>Passport Office</label>
                                        <select id="prevPassOffice" name="prevPassOffice">
                                            <option value="">Select</option>
                                            <option value="Ahmedabad">Ahmedabad</option>
                                            <option value="Bengaluru">Bengaluru</option>
                                            <option value="Chennai">Chennai</option>
                                            <option value="Delhi">Delhi</option>
                                            <option value="Hyderabad">Hyderabad</option>
                                            <option value="Mumbai">Mumbai</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 7: Other Details -->
                    <div id="stage7" class="form-stage">
                        <div class="form-section">
                            <h3>Other Details</h3>

                            <div class="form-group">
                                <label>Have you ever been known by other names (aliases)? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="aliases" value="no" required checked> No</label>
                                    <label><input type="radio" name="aliases" value="yes"> Yes</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Have you ever changed your name? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="nameChanged" value="no" required checked> No</label>
                                    <label><input type="radio" name="nameChanged" value="yes"> Yes</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Is either of your parent/spouse a government servant? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label><input type="radio" name="govServant" value="no" required checked> No</label>
                                    <label><input type="radio" name="govServant" value="yes"> Yes</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 8: Preview -->
                    <div id="stage8" class="form-stage">
                        <div class="info-box">
                            <strong>Application Preview</strong><br>
                            Please review your details before proceeding to verification.
                        </div>

                        <div id="previewContent" class="form-section">
                            <!-- Preview will be generated dynamically -->
                        </div>
                    </div>

                    <!-- Stage 9: Verification & CAPTCHA -->
                    <div id="stage9" class="form-stage">
                        <div class="warning-box">
                            <strong>Self Declaration:</strong> I hereby declare that the information provided is true and correct to the best of my knowledge and belief.
                        </div>

                        <div class="form-section">
                            <h3>Security Verification</h3>
                            
                            <div class="captcha-container">
                                <p><strong>Enter the characters shown below:</strong></p>
                                <div class="captcha-image" id="captchaCode"></div>
                                <button type="button" class="btn-secondary" onclick="refreshCaptcha()" style="padding: 8px 15px; margin-bottom: 15px;">
                                    ðŸ”„ Refresh CAPTCHA
                                </button>
                                <div style="max-width: 300px; margin: 0 auto;">
                                    <input type="text" id="captchaInput" name="captchaInput" placeholder="Enter CAPTCHA" required maxlength="6" style="text-align: center; font-size: 16px; letter-spacing: 4px;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="button-group">
                        <button type="button" class="btn-secondary" id="prevBtn" onclick="prevStage()" style="display: none;">â—€ Previous</button>
                        <button type="button" class="btn-primary" id="nextBtn" onclick="nextStage()">Next â–¶</button>
                        <button type="submit" class="btn-primary" id="submitBtn" style="display: none;">Submit Application</button>
                    </div>
                </form>
            </div>
        </div>

        <div style="background: #1e3a5f; color: white; text-align: center; padding: 20px; font-size: 13px;">
            Â©Content owned by Ministry of External Affairs, Government of India | Last Updated On 10.11.2025
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="success-icon">âœ…</div>
            <h2>Application Submitted Successfully!</h2>
            <p>Your passport application has been received.</p>
            <div class="reference-number" id="refNumber"></div>
            <p style="font-size: 14px; color: #666; margin-top: 10px;">You will receive a confirmation email shortly.</p>
            <button class="btn-primary" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        let currentStage = 1;
        let totalStages = 9;
        let currentUser = null;
        let captchaCode = '';
        let applicationType = 'fresh';
        let submittedApplications = JSON.parse(localStorage.getItem('submittedApplications') || '[]');

        const stageNames = {
            fresh: ['Passport Type', 'Applicant Details', 'Family Details', 'Address Details', 'Emergency Contact', 'Previous Passport', 'Other Details', 'Preview', 'Verification'],
            pcc: ['Passport Details', 'Applicant Details', 'Family Details', 'Address Details', 'Self Declaration'],
            identity: ['Applicant Details', 'Family Details', 'Address Details', 'Previous IC', 'Self Declaration']
        };

        // Initialize
        function initProgressSteps(type) {
            const steps = stageNames[type] || stageNames.fresh;
            totalStages = steps.length;
            
            const progressDiv = document.getElementById('progressSteps');
            progressDiv.innerHTML = '';
            
            steps.forEach((name, index) => {
                const step = document.createElement('div');
                step.className = 'step';
                if (index === 0) step.classList.add('active');
                step.innerHTML = `
                    <div class="step-circle">${index + 1}</div>
                    <div class="step-label">${name}</div>
                `;
                progressDiv.appendChild(step);
            });
        }

        function updateProgress() {
            const steps = document.querySelectorAll('.step');
            steps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < currentStage - 1) {
                    step.classList.add('completed');
                } else if (index === currentStage - 1) {
                    step.classList.add('active');
                }
            });
        }

        function nextStage() {
            const currentStageEl = document.getElementById(`stage${currentStage}`);
            if (currentStageEl) {
                const inputs = currentStageEl.querySelectorAll('input[required]:not([type="radio"]), select[required]');
                const radios = currentStageEl.querySelectorAll('input[required][type="radio"]');
                
                let valid = true;
                
                inputs.forEach(input => {
                    if (!input.value) {
                        valid = false;
                        input.reportValidity();
                    }
                });
                
                // Check radio groups
                const radioGroups = {};
                radios.forEach(radio => {
                    if (!radioGroups[radio.name]) {
                        radioGroups[radio.name] = [];
                    }
                    radioGroups[radio.name].push(radio);
                });
                
                for (let group in radioGroups) {
                    const checked = radioGroups[group].some(r => r.checked);
                    if (!checked) {
                        valid = false;
                        alert(`Please select an option for ${group}`);
                        break;
                    }
                }
                
                if (!valid) return;
            }

            document.getElementById(`stage${currentStage}`).classList.remove('active');
            currentStage++;
            if (currentStage > totalStages) currentStage = totalStages;
            
            document.getElementById(`stage${currentStage}`).classList.add('active');
            updateProgress();
            updateButtons();
            
            if (currentStage === totalStages - 1) {
                generatePreview();
            }
            
            window.scrollTo(0, 0);
        }

        function prevStage() {
            document.getElementById(`stage${currentStage}`).classList.remove('active');
            currentStage--;
            if (currentStage < 1) currentStage = 1;
            document.getElementById(`stage${currentStage}`).classList.add('active');
            updateProgress();
            updateButtons();
            window.scrollTo(0, 0);
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.style.display = currentStage > 1 ? 'block' : 'none';
            nextBtn.style.display = currentStage < totalStages ? 'block' : 'none';
            submitBtn.style.display = currentStage === totalStages ? 'block' : 'none';
        }

        function generatePreview() {
            const preview = document.getElementById('previewContent');
            const formData = new FormData(document.getElementById('applicationForm'));
            
            let html = '<h4 style="color: #003d82; margin-bottom: 15px;">Personal Details</h4>';
            html += `<p><strong>Name:</strong> ${formData.get('givenName')} ${formData.get('surname') || ''}</p>`;
            html += `<p><strong>DOB:</strong> ${formData.get('dob')}</p>`;
            html += `<p><strong>Gender:</strong> ${formData.get('gender')}</p>`;
            html += '<br><h4 style="color: #003d82; margin-bottom: 15px;">Contact Details</h4>';
            html += `<p><strong>Email:</strong> ${formData.get('email')}</p>`;
            html += `<p><strong>Mobile:</strong> ${formData.get('mobile')}</p>`;
            html += `<p><strong>Address:</strong> ${formData.get('houseNo')}, ${formData.get('city')}</p>`;
            
            preview.innerHTML = html;
        }

        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            currentUser = email;
            
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('userName').textContent = email.split('@')[0].toUpperCase();
            document.getElementById('welcomeName').textContent = email.split('@')[0].toUpperCase();
            document.getElementById('displayUserEmail').textContent = email;
            
            loadSubmittedApplications();
            loadSavedApplications();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginPage').style.display = 'block';
                currentUser = null;
            }
        }

        function showPage(event, page) {
            if (event) event.preventDefault();
            
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
            
            const pageMap = {
                'home': 'homePage',
                'services': 'servicesPage',
                'applications': 'applicationsPage',
                'fees': 'feesPage'
            };
            
            document.getElementById(pageMap[page]).classList.add('active');
            
            if (event) {
                event.target.classList.add('active');
            } else {
                document.querySelector(`[onclick*="${page}"]`).classList.add('active');
            }
        }

        function startApplication(type) {
            applicationType = type;
            document.getElementById('servicesPage').classList.remove('active');
            document.getElementById('applicationPage').classList.add('active');
            
            const titles = {
                fresh: 'Application for Fresh Passport/Re-issue of Passport',
                pcc: 'Application for Police Clearance Certificate',
                identity: 'Application for Identity Certificate'
            };
            
            document.getElementById('appTitle').textContent = titles[type];
            
            initProgressSteps(type);
            currentStage = 1;
            document.getElementById('stage1').classList.add('active');
            updateButtons();
            refreshCaptcha();
        }

        function refreshCaptcha() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            captchaCode = '';
            for (let i = 0; i < 6; i++) {
                captchaCode += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            const captchaEl = document.getElementById('captchaCode');
            if (captchaEl) {
                captchaEl.textContent = captchaCode;
            }
            const captchaInput = document.getElementById('captchaInput');
            if (captchaInput) {
                captchaInput.value = '';
            }
            
            // Send CAPTCHA to agent
            if (window.opener) {
                window.opener.postMessage({
                    type: 'CAPTCHA_CODE',
                    code: captchaCode
                }, '*');
            }
        }

        function updateDistricts() {
            const state = document.getElementById('state').value;
            const districtSelect = document.getElementById('district');
            
            const districts = {
                'AP': ['Tirupati', 'Visakhapatnam', 'Vijayawada'],
                'TN': ['Chennai', 'Coimbatore', 'Madurai'],
                'KA': ['Bengaluru', 'Mysuru', 'Mangaluru'],
                'DL': ['Central Delhi', 'South Delhi', 'North Delhi']
            };
            
            districtSelect.innerHTML = '<option value="">Select</option>';
            if (districts[state]) {
                districts[state].forEach(d => {
                    districtSelect.innerHTML += `<option value="${d}">${d}</option>`;
                });
            }
        }

        function togglePreviousPassport() {
            const value = document.querySelector('input[name="heldPassport"]:checked').value;
            document.getElementById('previousPassportFields').style.display = value === 'yes' ? 'block' : 'none';
        }

        // Listen for automation
        window.addEventListener('message', async function(event) {
            if (event.data.type === 'AUTO_FILL') {
                await autoFillForm(event.data.data);
            }
        });

        async function autoFillForm(data) {
            console.log('Auto-filling form with data:', data);
            
            // Navigate to application page if not already there
            if (!document.getElementById('applicationPage').classList.contains('active')) {
                startApplication('fresh');
                await new Promise(r => setTimeout(r, 1000));
            }
            
            const fieldMappings = [
                { id: 'givenName', value: data.givenName, stage: 2 },
                { id: 'surname', value: data.surname, stage: 2 },
                { id: 'gender', value: data.gender, stage: 2 },
                { id: 'dob', value: data.dob, stage: 2 },
                { id: 'placeOfBirth', value: data.placeOfBirth, stage: 2 },
                { id: 'maritalStatus', value: data.maritalStatus, stage: 2 },
                { id: 'citizenship', value: data.citizenship, stage: 2 },
                { id: 'employment', value: data.employment, stage: 2 },
                { id: 'education', value: data.education, stage: 2 },
                { id: 'fatherGivenName', value: data.fatherGivenName, stage: 3 },
                { id: 'fatherSurname', value: data.fatherSurname, stage: 3 },
                { id: 'motherGivenName', value: data.motherGivenName, stage: 3 },
                { id: 'motherSurname', value: data.motherSurname, stage: 3 },
                { id: 'houseNo', value: data.houseNo, stage: 4 },
                { id: 'city', value: data.city, stage: 4 },
                { id: 'pincode', value: data.pincode, stage: 4 },
                { id: 'state', value: data.state, stage: 4 },
                { id: 'mobile', value: data.mobile, stage: 4 },
                { id: 'email', value: data.email, stage: 4 },
                { id: 'emergencyName', value: data.emergencyName, stage: 5 },
                { id: 'emergencyMobile', value: data.emergencyMobile, stage: 5 },
                { id: 'emergencyAddress', value: data.emergencyAddress, stage: 5 }
            ];

            // Fill fields with animation
            for (const field of fieldMappings) {
                // Navigate to correct stage if needed
                if (currentStage !== field.stage) {
                    while (currentStage < field.stage) {
                        await new Promise(r => setTimeout(r, 300));
                        nextStage();
                        await new Promise(r => setTimeout(r, 500));
                    }
                }
                
                await new Promise(r => setTimeout(r, 600));
                const element = document.getElementById(field.id);
                if (element && field.value) {
                    element.value = field.value;
                    element.classList.add('auto-filling');
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    
                    // Trigger change event for selects
                    if (element.tagName === 'SELECT') {
                        element.dispatchEvent(new Event('change'));
                    }
                    
                    await new Promise(r => setTimeout(r, 700));
                    element.classList.remove('auto-filling');
                }
            }

            // Navigate to CAPTCHA stage
            await new Promise(r => setTimeout(r, 1000));
            while (currentStage < totalStages) {
                nextStage();
                await new Promise(r => setTimeout(r, 500));
            }
            
            document.getElementById('captchaInput').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('captchaInput').focus();
        }

        // Submit form
        document.getElementById('applicationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const captchaInput = document.getElementById('captchaInput').value.toUpperCase();
            if (captchaInput !== captchaCode) {
                alert('âŒ Invalid CAPTCHA! Please try again.');
                refreshCaptcha();
                return;
            }

            // Save application
            const formData = new FormData(this);
            const refNum = 'ARN' + Date.now().toString().slice(-10);
            
            const application = {
                referenceNumber: refNum,
                applicationType: applicationType === 'fresh' ? 'Fresh Passport' : applicationType === 'pcc' ? 'PCC' : 'Identity Certificate',
                applicantName: formData.get('givenName') + ' ' + (formData.get('surname') || ''),
                submissionDate: new Date().toLocaleDateString('en-GB'),
                paymentStatus: 'Pending',
                appointmentDate: '-',
                email: formData.get('email'),
                mobile: formData.get('mobile')
            };
            
            submittedApplications.push(application);
            localStorage.setItem('submittedApplications', JSON.stringify(submittedApplications));
            
            document.getElementById('refNumber').textContent = refNum;
            document.getElementById('successModal').classList.add('show');
            
            // Notify agent
            if (window.opener) {
                window.opener.postMessage({
                    type: 'SUBMISSION_SUCCESS',
                    referenceNumber: refNum
                }, '*');
            }
        });

        function closeModal() {
            document.getElementById('successModal').classList.remove('show');
            showPage(null, 'applications');
            document.getElementById('applicationForm').reset();
            currentStage = 1;
            loadSubmittedApplications();
        }

        function loadSubmittedApplications() {
            const tbody = document.getElementById('submittedApplicationsTable');
            
            if (submittedApplications.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #666;">No applications submitted yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            submittedApplications.forEach(app => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${app.applicationType}</td>
                    <td>${app.referenceNumber}</td>
                    <td>${app.applicantName}</td>
                    <td>${app.submissionDate}</td>
                    <td><span style="color: #ff9800; font-weight: bold;">${app.paymentStatus}</span></td>
                    <td>${app.appointmentDate}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadSavedApplications() {
            const savedDiv = document.getElementById('savedApplications');
            
            if (submittedApplications.length === 0) {
                savedDiv.innerHTML = '<p style="color: #666;">No saved applications</p>';
                return;
            }
            
            savedDiv.innerHTML = '';
            submittedApplications.slice(0, 2).forEach(app => {
                const card = document.createElement('div');
                card.className = 'app-card';
                card.innerHTML = `
                    <h4>${app.applicationType}</h4>
                    <div class="app-card-row">
                        <span><strong>Applicant Name:</strong></span>
                        <span>${app.applicantName}</span>
                    </div>
                    <div class="app-card-row">
                        <span><strong>Application Reference No. (ARN):</strong></span>
                        <span style="color: #ff6b00; font-weight: bold;">${app.referenceNumber}</span>
                    </div>
                    <button class="btn-primary" style="margin-top: 10px; width: auto; padding: 8px 20px;" onclick="showPage(null, 'applications')">View Details</button>
                `;
                savedDiv.appendChild(card);
            });
            
            if (submittedApplications.length > 2) {
                const viewAll = document.createElement('button');
                viewAll.className = 'btn-secondary';
                viewAll.textContent = 'View All';
                viewAll.style.marginTop = '15px';
                viewAll.onclick = () => showPage(null, 'applications');
                savedDiv.appendChild(viewAll);
            }
        }

        function calculateFee() {
            const appType = document.getElementById('feeAppType').value;
            const serviceType = document.getElementById('feeServiceType').value;
            const age = document.getElementById('feeAge').value;
            const scheme = document.getElementById('feeScheme').value;
            
            if (!appType || !serviceType || !age || !scheme) {
                alert('Please fill all required fields');
                return;
            }
            
            let fee = 0;
            
            // Fee calculation based on type
            if (appType === 'passport') {
                if (serviceType === 'normal') {
                    fee = scheme === '36' ? 1500 : 2000;
                } else { // tatkaal
                    fee = scheme === '36' ? 3500 : 4000;
                }
                
                // Apply discount for minor and senior
                if (age === 'minor' || age === 'senior') {
                    fee = fee * 0.9; // 10% discount
                }
            } else if (appType === 'pcc') {
                fee = 500;
            } else if (appType === 'identity') {
                fee = 300;
            }
            
            document.getElementById('feeAmount').textContent = 'â‚¹ ' + fee.toFixed(0);
            document.getElementById('feeResult').classList.add('show');
        }

        // Initialize on load
        refreshCaptcha();
        
        // Listen for CAPTCHA requests from agent
        window.addEventListener('message', function(event) {
            if (event.data.type === 'REQUEST_CAPTCHA') {
                refreshCaptcha();
            }
        });
    </script>
</body>
</html>